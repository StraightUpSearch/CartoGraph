# UK Ecommerce Domain Intelligence SaaS: Claude Code Execution Brief

> **Document purpose:** This is the single source of truth for building the platform. Each stack is a self contained module. Execute them in order. Every stack includes a prompt module block (ROLE/INPUTS/TASK) that can be reused for agent orchestration, plus concrete technical specs for implementation.

---

## How to use this document in Claude Code

1. Read the full brief before writing any code.
2. Each stack maps to a development phase. Start with Stack 2 (data model) and Stack 3 (agents), then Stack 4 (UX), then Stack 5 (monetisation).
3. Variable placeholders like `[COUNTRY]` should be implemented as environment variables or config objects.
4. JSON schemas are canonical. Build database migrations from them.
5. Agent prompt templates are production ready. Wire them into the orchestrator.
6. All pricing, tier gating, and feature access rules are defined in Stack 5. Implement them as feature flags.

---

## Variable reference (global)

```python
# config/variables.py
VARIABLES = {
    "COUNTRY": "UK",                    # Default market
    "EXPANSION_COUNTRY": "USA",         # Future market
    "KEYWORD_SET": [],                  # Generated by Keyword Miner Agent
    "INTENT_TYPE": [                    # Commercial intent classifications
        "transactional",
        "commercial_investigation",
        "price_sensitive",
        "delivery_focused",
        "geo_qualified"
    ],
    "SERP_FEATURE": [                   # Tracked SERP features
        "shopping_carousel",
        "people_also_ask",
        "featured_snippet",
        "local_pack",
        "sitelinks",
        "image_pack",
        "ai_overview"
    ],
    "DATA_SOURCE": [                    # Pluggable data providers
        "dataforseo_serp",
        "dataforseo_backlinks",
        "moz_api",
        "wappalyzer_self_hosted",
        "direct_scrape",
        "companies_house_api",
        "search_console_import",
        "internal_calculation"
    ],
    "UPDATE_FREQUENCY": [               # Cron cadences
        "daily",
        "weekly",
        "bi_weekly",
        "monthly",
        "quarterly"
    ],
    "SUBSCRIPTION_TIER": [              # Product tiers
        "free",
        "starter",
        "professional",
        "business",
        "enterprise"
    ],
    "USER_PERSONA": [                   # Target customers
        "agency",
        "saas_vendor",
        "affiliate_seo",
        "link_builder",
        "pe_investor",
        "dtc_brand",
        "aggregator",
        "analyst"
    ]
}
```

---

## STACK 1: Strategy and Positioning

### Prompt module

```text
ROLE
  You are a senior SaaS product strategist for an SEO data product.

INPUTS
  [COUNTRY], [USER_PERSONA], [INTENT_TYPE], [SERP_FEATURE], [UPDATE_FREQUENCY], [SUBSCRIPTION_TIER]

TASK
  Position a subscription database that compounds domain intelligence over time.
  Emphasise commercial shopping intent and SERP feature segmentation.
  Output: ICP, use cases, moat, monetisation hooks, positioning statement.
```

### Market context

The UK ecommerce market contains approximately 1.07 million ecommerce enabled websites generating £127.4 billion in annual online retail sales. Internet sales represent 27.4% of all UK retail (2025), with December 2025 hitting 28.3%. Platform market share: Wix 23.3%, Shopify 23.1%, WooCommerce 15.6%, Squarespace 15.1%.

No dedicated UK ecommerce domain intelligence platform exists. The nearest competitors operate globally with limited UK depth.

### Ideal customer profiles

| Priority | [USER_PERSONA] | Monthly budget | Primary need | Value driver |
|----------|----------------|----------------|--------------|-------------|
| P1 | Digital marketing agencies | £75 to £250/mo | Client prospecting, competitive audits, white label reports | ROI per client won |
| P2 | SaaS companies selling to ecommerce merchants | £150 to £500/mo | Lead generation, CRM enrichment, app install tracking | Direct pipeline value |
| P3 | Affiliate SEOs and content publishers | £30 to £100/mo | Niche discovery, affiliate programme detection, traffic estimates | Find money SERPs early |
| P4 | Link builders and outreach specialists | £75 to £200/mo | Prospect lists filtered by DR/niche/contact availability | Volume of qualified targets |
| P5 | PE/M&A firms and ecommerce aggregators | £500 to £2,000/mo | Deal sourcing, due diligence, revenue estimation | Data as alpha |
| P6 | DTC brands (competitive intelligence) | £75 to £200/mo | Competitor monitoring, benchmarking, tech stack changes | See who outranks them |

### Use cases mapped to retention

| Use case | Personas served | Retention hook |
|----------|----------------|----------------|
| Lead gen: find high intent UK stores by category, DR, traffic, platform | Agencies, SaaS vendors | Saved filters + new domain alerts |
| Competitor research: who wins for product terms, track drift over time | DTC brands, agencies | Trending deltas, monthly reports |
| Link prospecting: segment stores by intent score, schema maturity, outreach readiness | Link builders, agencies | Export credits, contact enrichment |
| Acquisition targeting: undervalued domains with rising commercial visibility | PE/M&A, aggregators | Historical trends, revenue estimates |
| Niche discovery: find profitable verticals with affiliate programmes | Affiliate SEOs | Affiliate detection, SERP feature data |

### Competitive moat

| Moat layer | Description | Why competitors cannot easily replicate |
|------------|-------------|----------------------------------------|
| Intent validation | Every domain verified via SERP presence for commercial keyword patterns | Requires continuous SERP crawling investment; BuiltWith and Store Leads do not do this |
| UK depth over global breadth | Deeper enrichment per UK domain than any global tool | First mover advantage in niche positioning |
| Compound enrichment | Seven agent pipeline creates layered intelligence no single API provides | Integration complexity deters casual competitors |
| SERP feature intelligence | Tracks which domains appear in Shopping carousels, PAA, AI Overviews | Proprietary dataset from continuous SERP monitoring |
| Freshness moat | Scheduled deltas and replayable snapshots, not one off exports | Operational execution requirement |
| Compliance moat | Minimise personal data, store signals not scraped address books | Reduces legal risk vs competitors who scrape freely |

### Monetisation hooks (embed these in UI copy)

| Hook | Where it appears |
|------|-----------------|
| "Find buyers, not browsers" | Homepage hero, filter panel header |
| "Catch winners early" | Trending deltas tab |
| "Export outreach ready lists" | Export gate modal |
| "See who outranks you on buying terms" | Competitor comparison view |
| "Repeatable market maps for clients" | Agency tier landing page |

### Positioning statement

The only continuously updated [COUNTRY] database of ecommerce domains validated through commercial search intent analysis. Every domain is verified by SERP presence for [INTENT_TYPE] queries, segmented by [SERP_FEATURE], with compounding enrichment and change tracking. Unlike Store Leads (Shopify centric, global breadth, $75+/mo) or BuiltWith (technology only, $295+/mo), this platform combines technology detection, SEO metrics, SERP feature data, and commercial intent signals into one product built specifically for the UK market at a fraction of the cost.

---

## STACK 2: Data Model Architecture

### Prompt module

```text
ROLE
  You are a technical SEO architect and data modeller.

INPUTS
  [COUNTRY], [INTENT_TYPE], [SERP_FEATURE], [DATA_SOURCE]

TASK
  Design a modular schema where each domain gains richer fields over time.
  Use three grains: domain, URL, keyword, joined via timestamped facts.
  Keep immutable facts separate from time series metrics.
  Persist raw SERP snapshots or provider payload hashes for audit and reprocessing.
  Model "evidence" as a list so confidence scores stay explainable.
  Output a JSON schema example plus a field catalogue with monetisation value.
```

### Data model principles

1. **Three grains:** domain, URL, keyword. Each is a first class entity. They join via timestamped fact tables.
2. **Immutable vs time series:** Static facts (domain registration, platform detection) are stored on the entity. Metrics that change (traffic, DR, positions) go into time series tables.
3. **Evidence based scoring:** Every confidence score and intent score includes an `evidence` array explaining how it was derived.
4. **Raw payload retention:** Store hashes of provider responses for audit trail and reprocessing.
5. **Schema versioning:** Every record includes `schema_version` for migration safety.

### Primary database: PostgreSQL

Use PostgreSQL with JSONB columns for flexible enrichment fields. GIN indexes on JSONB for fast filtering. Separate read replica for API and dashboard queries.

### Analytics database: ClickHouse

Time series metrics (traffic, DR, keyword positions, SERP features) flow via CDC (PeerDB) from PostgreSQL to ClickHouse for fast analytical queries, trending calculations, and historical comparisons.

### Canonical JSON schema: domain record

```json
{
  "schema_version": "1.0.0",
  "domain_id": "uuid",
  "domain": "example.co.uk",
  "country": "[COUNTRY]",
  "tld": ".co.uk",
  "status": "active",
  "first_seen_at": "2026-02-18T00:00:00Z",
  "last_updated_at": "2026-02-18T00:00:00Z",

  "discovery": {
    "method": "serp_scrape",
    "source_query": "buy running shoes uk",
    "source_keyword_set": "footwear_commercial",
    "intent_type": "transactional",
    "first_seen": "2026-02-18T00:00:00Z",
    "last_verified": "2026-02-18T00:00:00Z"
  },

  "ecommerce": {
    "platform": "Shopify",
    "platform_plan": "Plus",
    "platform_confidence": 0.9,
    "product_count_estimate": 2400,
    "category_primary": "sportswear",
    "category_secondary": ["footwear", "activewear"],
    "has_affiliate_programme": false,
    "affiliate_evidence": {
      "has_affiliate_page": false,
      "utm_affiliate_patterns_seen": false,
      "network_scripts_detected": [],
      "confidence": 0.3
    },
    "payment_providers": ["Stripe", "PayPal", "Klarna"],
    "shipping_providers": ["DPD", "Royal Mail"],
    "currency": "GBP",
    "google_merchant_centre": true
  },

  "seo_metrics": {
    "domain_rating": 54,
    "domain_authority": 48,
    "spam_score": 12,
    "organic_traffic_estimate": 89000,
    "organic_keywords_count": 14200,
    "referring_domains_count": 1840,
    "backlinks_count": 23400,
    "organic_traffic_trend": "growing",
    "source": "dataforseo_backlinks",
    "as_of": "2026-02-18"
  },

  "intent_layer": {
    "commercial_intent_score": 8,
    "percent_traffic_from_intent": {
      "commercial": 0.44,
      "transactional": 0.38,
      "shopping": 0.18,
      "source": "internal_calculation"
    },
    "shopping_modifier_density": {
      "value": 0.31,
      "method": "modifiers_per_keyword_token",
      "as_of": "2026-02-18"
    }
  },

  "serp_intelligence": {
    "serp_visibility_score": 7.4,
    "commercial_queries_ranking": 342,
    "serp_features": {
      "shopping_carousel": true,
      "people_also_ask": true,
      "featured_snippet": false,
      "local_pack": false,
      "sitelinks": true,
      "image_pack": false,
      "ai_overview": false
    },
    "top_ranking_queries": [
      {
        "query": "buy running shoes uk",
        "position": 3,
        "search_volume": 14800,
        "serp_feature": "shopping_carousel",
        "as_of": "2026-02-18"
      }
    ]
  },

  "technical_layer": {
    "tech_stack": {
      "detected_via": "wappalyzer_self_hosted",
      "technologies": ["Shopify", "Klaviyo", "Stripe", "Cloudflare", "GA4", "Hotjar"],
      "technology_count": 6
    },
    "schema_usage": {
      "product_schema_present": true,
      "review_schema_present": true,
      "offer_schema_present": true,
      "merchant_listing_eligible": true,
      "evidence_urls": ["https://example.co.uk/product/sku123/"]
    },
    "indexation_signals": {
      "robots_txt_present": true,
      "robots_allows_product_paths": true,
      "noindex_found_on_templates": false,
      "canonical_pattern_ok": true,
      "sitemap_present": true
    }
  },

  "contact": {
    "business_email": "info@example.co.uk",
    "phone": "+44 1234 567890",
    "physical_address": "123 High Street, London, EC1A 1BB",
    "has_contact_form": true,
    "social_profiles": {
      "instagram": "https://instagram.com/example",
      "facebook": "https://facebook.com/example",
      "linkedin": "https://linkedin.com/company/example",
      "twitter": null,
      "tiktok": null,
      "youtube": null,
      "pinterest": null
    }
  },

  "marketplace_overlap": {
    "amazon_overlap_score": 0.2,
    "etsy_overlap_score": 0.0,
    "ebay_overlap_score": 0.1,
    "evidence": ["brand+amazon serp cooccurrence"]
  },

  "paid_ads_presence": {
    "seen_in_serp_ads": true,
    "source": "serp_snapshot",
    "as_of": "2026-02-18"
  },

  "meta": {
    "title": "Example Store | Running Shoes UK",
    "description": "Buy running shoes online with free UK delivery.",
    "language": "en",
    "estimated_monthly_revenue_gbp": 450000,
    "employee_count_estimate": 25,
    "company_age_years": 8.5,
    "companies_house_number": "12345678",
    "ssl_valid": true,
    "mobile_friendly": true,
    "page_speed_score": 72
  },

  "change_tracking": {
    "mom_traffic_delta": {
      "absolute": 12000,
      "percent": 0.11,
      "as_of": "2026-02-01"
    },
    "keyword_wins_last_30d": 18,
    "keyword_losses_last_30d": 9,
    "feature_gains_last_30d": ["shopping_carousel"],
    "feature_losses_last_30d": [],
    "trending_score": 7.2
  },

  "confidence_score": {
    "value": 0.82,
    "explain": [
      "product_schema_detected",
      "checkout_path_detected",
      "commercial_serp_presence_high",
      "platform_detected_high_confidence"
    ]
  },

  "pipeline": {
    "last_serp_crawl": "2026-02-17T04:00:00Z",
    "last_tech_detection": "2026-02-10T12:00:00Z",
    "last_seo_enrichment": "2026-02-15T08:00:00Z",
    "last_contact_enrichment": "2026-01-20T10:00:00Z",
    "freshness_score": 8.4,
    "crawl_priority": 3,
    "enrichment_completeness": 0.91,
    "schema_version": "1.0.0"
  },

  "ai_summary": {
    "text": "example.co.uk is an active UK ecommerce store on Shopify Plus in the sportswear category. DR 54 with approximately 89K monthly organic visitors and 1,840 referring domains. Stack includes Klaviyo, Stripe, Cloudflare. Appears in Shopping carousels and PAA. Traffic trending up 11% MoM.",
    "model_version": "llama3_8b_v1",
    "generated_at": "2026-02-18T06:00:00Z"
  }
}
```

### Field catalogue with monetisation value

| Field group | Field | [DATA_SOURCE] | [UPDATE_FREQUENCY] | Monetisation value | Minimum tier |
|-------------|-------|---------------|--------------------|--------------------|-------------|
| Discovery | domain | SERP scrape | On discovery | Foundation record, paywall unit for exports | Free |
| Discovery | intent_type | SERP keyword analysis | Weekly | Core differentiator: proves commercial intent | Starter |
| Discovery | source_query | SERP scrape | Weekly | Shows which commercial queries triggered discovery | Professional |
| Ecommerce | platform | Wappalyzer (self hosted) | Bi weekly | High: enables platform based filtering | Starter |
| Ecommerce | platform_plan | HTTP response analysis | Monthly | Very high: Shopify Plus signals enterprise scale | Professional |
| Ecommerce | product_count_estimate | Sitemap/structured data | Monthly | Medium: indicates store size | Starter |
| Ecommerce | has_affiliate_programme | Page content scan | Monthly | Very high: unique data point, no competitor offers this | Professional |
| Ecommerce | google_merchant_centre | SERP Shopping data | Weekly | High: active Google Shopping participation | Professional |
| SEO metrics | domain_rating | DataForSEO Backlinks API | Weekly | High: primary filtering metric for link builders | Starter |
| SEO metrics | organic_traffic_estimate | DataForSEO | Weekly | Very high: core metric for all personas | Professional |
| SEO metrics | organic_traffic_trend | Calculated from history | Weekly | Very high: growth signal for investors | Business |
| Intent | commercial_intent_score | Internal calculation | Weekly | Core premium filter, drives Pro upgrades | Professional |
| Intent | percent_traffic_from_intent | Internal calculation | Weekly | Identifies "real sellers", reduces noise | Professional |
| Intent | shopping_modifier_density | Internal calculation | Weekly | Quick lead qualification | Professional |
| SERP intel | serp_visibility_score | Calculated from SERP data | Weekly | Very high: proprietary score, strong differentiator | Professional |
| SERP intel | shopping_carousel | DataForSEO SERP | Weekly | Very high: unique competitive data | Professional |
| SERP intel | top_ranking_queries | DataForSEO SERP | Weekly | Extremely high: commercial terms a domain ranks for | Business |
| SERP intel | ai_overview | DataForSEO SERP | Weekly | High: emerging SERP feature, early tracking advantage | Professional |
| Technology | all_technologies | Wappalyzer (self hosted) | Bi weekly | High: tech based prospecting for SaaS vendors | Starter |
| Technology | schema_usage | HTML parse | Bi weekly | High: technical SEO maturity indicator | Professional |
| Technology | merchant_listing_eligible | Structured data analysis | Bi weekly | High: shopping readiness signal | Professional |
| Contact | business_email | Web scrape | Monthly | Very high: enables direct outreach | Professional |
| Contact | social_profiles | Web scrape | Monthly | High: enables social selling | Starter |
| Contact | phone | Web scrape | Monthly | High: direct contact | Business |
| Meta | estimated_monthly_revenue_gbp | Traffic x conversion model | Monthly | Extremely high: core metric for PE/M&A | Business |
| Meta | companies_house_number | Companies House API | Quarterly | High: UK specific enrichment, confidence boost | Business |
| Meta | page_speed_score | Lighthouse API | Monthly | Medium: technical health indicator | Starter |
| Change tracking | mom_traffic_delta | Calculated from snapshots | Monthly | Extremely high: trend data is premium | Business |
| Change tracking | keyword_wins_losses | Calculated | Monthly | High: directional indicator | Business |
| Change tracking | feature_gains_losses | Calculated | Monthly | Very high: SERP landscape shifts | Business |
| Historical | All metric change logs | Snapshots | Weekly | Extremely high: full trend archive | Business (12mo), Enterprise (full) |

### Compliance design rules (implement these in every agent)

1. Treat any personal email as personal data, even in a work context. Store only generic business addresses (info@, hello@, sales@, support@, contact@).
2. Do not bulk scrape personal contact data. Public data still falls under UK GDPR.
3. Provide a domain owner removal workflow (GDPR right to erasure).
4. Store contact signals, not harvested address books.
5. Gate personal contact enrichment behind explicit user consent and a paid add on.

### Database migration plan

```sql
-- Phase 1: Core tables
CREATE TABLE domains (
    domain_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    domain VARCHAR(255) NOT NULL UNIQUE,
    country VARCHAR(2) NOT NULL DEFAULT 'UK',
    tld VARCHAR(20),
    status VARCHAR(20) DEFAULT 'active',
    first_seen_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    last_updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    schema_version VARCHAR(10) DEFAULT '1.0.0',
    discovery JSONB,
    ecommerce JSONB,
    seo_metrics JSONB,
    intent_layer JSONB,
    serp_intelligence JSONB,
    technical_layer JSONB,
    contact JSONB,
    marketplace_overlap JSONB,
    paid_ads_presence JSONB,
    meta JSONB,
    change_tracking JSONB,
    confidence_score JSONB,
    pipeline JSONB,
    ai_summary JSONB
);

-- Indexes for common filter patterns
CREATE INDEX idx_domains_country ON domains(country);
CREATE INDEX idx_domains_status ON domains(status);
CREATE INDEX idx_domains_dr ON domains((seo_metrics->>'domain_rating')::int);
CREATE INDEX idx_domains_traffic ON domains((seo_metrics->>'organic_traffic_estimate')::int);
CREATE INDEX idx_domains_intent ON domains((intent_layer->>'commercial_intent_score')::int);
CREATE INDEX idx_domains_platform ON domains((ecommerce->>'platform'));
CREATE INDEX idx_domains_category ON domains((ecommerce->>'category_primary'));
CREATE INDEX idx_domains_discovery_gin ON domains USING GIN (discovery);
CREATE INDEX idx_domains_serp_features_gin ON domains USING GIN (serp_intelligence);
CREATE INDEX idx_domains_tech_gin ON domains USING GIN (technical_layer);

-- Phase 2: Time series in ClickHouse (via CDC)
-- domain_metrics_history: domain_id, date, dr, da, traffic, keywords_count, refdomains
-- serp_snapshots: keyword, domain, position, serp_features, date
-- technology_changelog: domain_id, field, old_value, new_value, detected_at
```

---

## STACK 3: Agent and Data Collection Logic

### Prompt module

```text
ROLE
  You are a data pipeline engineer designing cron driven agents.

INPUTS
  [COUNTRY], [KEYWORD_SET], [INTENT_TYPE], [SERP_FEATURE], [DATA_SOURCE], [UPDATE_FREQUENCY]

TASK
  Define agent roles, cron cadence, validation, dedupe, recovery, logging.
  Provide modular prompts per agent with JSON only outputs.
```

### Critical constraint: SERP collection legality

Direct automated querying of Google violates their TOS and triggers enforcement. The Google Custom Search JSON API is being deprecated (transition before 1 Jan 2027). Therefore:

**Make [DATA_SOURCE] pluggable. Support three ingestion modes:**

| Mode | Description | Use when |
|------|-------------|----------|
| Mode A (preferred) | Licensed SERP provider (DataForSEO queued mode at ~£0.0005/query) | Primary production mode |
| Mode B | Keyword database SERP endpoints (Ahrefs API, SEMrush API) | Supplementary enrichment |
| Mode C | Customer connected Search Console imports | Private enrichment, user initiated |

Implement a provider interface so any [DATA_SOURCE] can be swapped without changing agent logic.

### Seven agent pipeline

#### Agent 1: Keyword Miner Agent

**Purpose:** Generate and maintain [KEYWORD_SET] by combining intent modifiers with product categories.

**[UPDATE_FREQUENCY]:** Weekly refresh of keyword queue; daily rotation of query batches

**Keyword construction formula:**
```
[INTENT_MODIFIER] + [PRODUCT_CATEGORY] + [GEO_MODIFIER]
```

**UK intent modifiers (ranked by commercial signal strength):**
1. "buy" + [product] + "UK"
2. "buy" + [product] + "online"
3. "shop" + [product] + "UK"
4. "best" + [product] + "UK" + [year]
5. [product] + "free delivery"
6. [product] + "next day delivery"
7. "cheap" + [product] + "UK"
8. [product] + "sale"
9. [product] + "discount code"
10. [product] + "voucher"

**Product categories source:** Google Product Taxonomy (UK version), 5,427 categories, 200 priority categories initially.

**Estimated query volume:** 50,000 initial, scaling to 250,000 at full UK coverage.

**Agent prompt template:**

```text
SYSTEM
  You extract and cluster commercial shopping keywords for [COUNTRY].

USER
  Inputs:
    seed_terms: <array>
    modifiers: <array>
    negatives: <array>
    intent_types: [INTENT_TYPE]
    max_keywords: <int>
    locale: [COUNTRY]
  Output rules:
    Return JSON only.
    Include cluster_id, intent_type, priority_score, and rationale.
```

**Output schema:**
```json
{
  "keywords": [
    {
      "keyword": "buy running shoes uk",
      "cluster_id": "footwear_running",
      "intent_type": "transactional",
      "priority_score": 9,
      "modifiers_present": ["buy", "uk"],
      "rationale": "High commercial intent, geo qualified"
    }
  ]
}
```

---

#### Agent 2: SERP Discovery Agent

**Purpose:** Discover new UK ecommerce domains by querying SERPs for commercial intent keywords. Also captures SERP feature presence per query.

**[DATA_SOURCE]:** DataForSEO SERP API (queued mode)

**[UPDATE_FREQUENCY]:** Daily (rotating keyword batches; full keyword set cycles every 7 days)

**Pipeline flow:**
1. Load next batch from keyword queue (500 to 1,000 queries per run)
2. Submit to DataForSEO queued endpoint (google.co.uk, language=en, location=United Kingdom)
3. Parse organic results positions 1 to 30
4. Extract all unique domains from results
5. Check against existing database; flag new domains for enrichment
6. Record SERP features present per query (shopping_carousel, people_also_ask, featured_snippet, local_pack, sitelinks, image_pack, ai_overview)
7. Store raw SERP data (or payload hash) for historical analysis and reprocessing
8. Update serp_intelligence fields for known domains

**Validation rules:**
- Domain must resolve (HTTP 200 or 301)
- Domain must be UK relevant: .co.uk/.uk TLD, OR .com with UK geo signals (GBP currency, UK shipping, UK address)
- Exclude marketplace listing pages (filter Amazon, eBay, Etsy product URLs)
- Exclude directories, news sites, and information only resources
- Respect robots.txt (signals crawl preferences, avoids overload)

**Error handling:**
- HTTP 429 (rate limit): Exponential backoff starting at 60 seconds, max 5 retries
- API timeout: Re queue with lower priority after 3 failures
- Invalid response: Log to dead letter queue, alert if failure rate exceeds 5%

**Agent prompt template:**

```text
SYSTEM
  You collect structured SERP snapshots for [COUNTRY] and tag [SERP_FEATURE].

USER
  Inputs:
    keywords: [KEYWORD_SET]
    serp_features_to_detect: [SERP_FEATURE]
    device: <desktop|mobile>
    geo: [COUNTRY]
    fetch_mode: <licensed_provider|keyword_db|import>
  Output rules:
    Return JSON only.
    For each keyword include urls, domains, positions, feature_flags, fetched_at.
```

---

#### Agent 3: Domain Classifier Agent

**Purpose:** Determine if a discovered domain is a genuine ecommerce store vs blog, directory, news site, or other non store.

**Run this BEFORE expensive enrichment (Agents 4 and 5) to avoid wasting API budget.**

**Ecommerce validation signals (evidence based):**
- Product structured data presence (Product, Offer schemas)
- Checkout path detection (/cart, /checkout URL patterns)
- Ecommerce platform detection (Shopify, WooCommerce, Magento signatures)
- Commercial SERP presence (ranking for transactional queries)
- Payment provider scripts detected
- Merchant listing eligible structured data

**Agent prompt template:**

```text
SYSTEM
  You classify domains as ecommerce store vs non store.

USER
  Inputs:
    domain: <string>
    sample_urls: <array>
    serp_evidence: <object>
    html_signals: <object>
  Output rules:
    Return JSON only.
    Include is_ecommerce, confidence_0_to_1, evidence_list, exclusions_triggered.
```

**Output schema:**
```json
{
  "domain": "example.co.uk",
  "is_ecommerce": true,
  "confidence": 0.87,
  "evidence": [
    "product_schema_detected",
    "checkout_path_detected",
    "shopify_platform_fingerprint",
    "commercial_serp_presence"
  ],
  "exclusions_triggered": []
}
```

---

#### Agent 4: SEO Metrics Enrichment Agent

**Purpose:** Populate DR, DA, backlink counts, referring domains, organic traffic estimates, keyword counts.

**[DATA_SOURCE]:** DataForSEO Backlinks API (primary) + Moz Links API (supplementary)

**[UPDATE_FREQUENCY]:** Weekly for top 20% of domains (by traffic); bi weekly for remainder

**Pipeline flow:**
1. Pull domain batch sorted by crawl_priority
2. Call DataForSEO Domain Analytics: rank, organic_traffic, backlinks, referring_domains
3. Call DataForSEO Backlinks Summary: DR equivalent, dofollow ratio
4. Call Moz API: Domain Authority, Page Authority, Spam Score
5. Calculate organic_traffic_trend by comparing current value against 4 week rolling average
6. Write all metrics to seo_metrics fields
7. Push snapshot to ClickHouse domain_metrics_history table

**Validation:**
- Cross check DataForSEO and Moz authority scores; flag where they diverge by more than 30 points
- Organic traffic below 10/mo: mark as "low_traffic_flagged"
- Spam Score above 60: flag for potential exclusion from premium datasets

**Cost per domain:** ~£0.03 per full enrichment cycle (DataForSEO + Moz combined)

**Agent prompt template:**

```text
SYSTEM
  You enrich domains and URLs using [DATA_SOURCE] metrics.

USER
  Inputs:
    domains: <array>
    keywords: <array>
    country: [COUNTRY]
  Output rules:
    Return JSON only.
    Include authority, traffic_estimates, top_keywords, url_metrics, as_of.
```

---

#### Agent 5: Tech Stack Analyser Agent

**Purpose:** Detect ecommerce platform, CMS, analytics, marketing tools, payment gateways, all installed technologies.

**[DATA_SOURCE]:** Self hosted Wappalyzer open source engine (MIT licence) via Playwright headless browser

**[UPDATE_FREQUENCY]:** Bi weekly for existing domains; immediate for newly discovered domains

**Pipeline flow:**
1. Pull batch of domains requiring tech detection (sorted by freshness_score descending)
2. Launch headless Chromium via Playwright
3. Navigate to domain root; wait for JavaScript execution (5 second timeout)
4. Run Wappalyzer fingerprint analysis against HTTP headers, HTML source, JavaScript globals, DOM patterns, cookies
5. Extract all detected technologies with confidence scores and version numbers
6. Classify into functional categories (ecommerce_platform, cms, analytics, email_provider, live_chat, cdn, payment_gateway, marketing_tools)
7. Compare with previous detection; log changes to technology_changelog table
8. Detect platform plan signals (e.g. Shopify checkout URL patterns indicate Basic vs Plus)

**Validation:**
- Technology confidence score must exceed 0.5 to be recorded
- At least one ecommerce platform must be detected for domain to remain classified as ecommerce
- Zero technologies after full render: flag for manual review

**Capacity:** 3 worker instances process ~15,000 domains per day

**Agent prompt template:**

```text
SYSTEM
  You detect ecommerce platform and technologies and return a compact stack profile.

USER
  Inputs:
    domain: <string>
    tech_sources: <array>
  Output rules:
    Return JSON only.
    Include platform_name, platform_confidence, technologies, as_of.
    Do not return personal emails.
```

---

#### Agent 6: Intent Scoring Agent

**Purpose:** Calculate commercial intent score, modifier density, and traffic split by intent type.

**[DATA_SOURCE]:** Internal calculation using outputs from Agents 1, 2, and 4

**[UPDATE_FREQUENCY]:** Weekly

**Scoring methodology:**

```
commercial_intent_score (1 to 10) =
  (% keywords with commercial modifiers × 3) +
  (SERP feature presence weight × 2) +
  (product schema detected × 1.5) +
  (paid ads presence × 1) +
  (checkout path detected × 1.5) +
  (merchant listing eligible × 1)
  
  Normalised to 1 to 10 scale
```

**SERP feature weights for visibility score:**
- shopping_carousel: 3x
- ai_overview: 2x
- featured_snippet: 2x
- sitelinks: 1.5x
- people_also_ask: 1x
- local_pack: 1x
- image_pack: 0.5x

**Agent prompt template:**

```text
SYSTEM
  You score commercial intent using keyword, SERP, and site evidence.

USER
  Inputs:
    domain: <string>
    keyword_profile: <object>
    serp_features: <object>
    traffic_split_inputs: <object>
  Output rules:
    Return JSON only.
    Include commercial_intent_score_1_to_10, percent_traffic_from_intent, modifier_density, explain.
```

---

#### Agent 7: Change Detection Agent

**Purpose:** Compute monthly deltas, trending scores, and identify significant shifts.

**[DATA_SOURCE]:** Internal snapshots

**[UPDATE_FREQUENCY]:** Monthly (full delta); daily (sampling for trending alerts)

**Pipeline flow:**
1. For each domain, compare current month snapshot with previous month
2. Calculate traffic_delta (absolute and percentage)
3. Count keyword wins and losses (position improvements/declines)
4. Detect SERP feature gains and losses
5. Calculate trending_score based on weighted deltas
6. Flag domains exceeding threshold deltas for alerts
7. Write results to change_tracking fields and ClickHouse

**Agent prompt template:**

```text
SYSTEM
  You compute month deltas and trending ranks for domains.

USER
  Inputs:
    domain_id: <string>
    current_snapshot: <object>
    prior_snapshot: <object>
  Output rules:
    Return JSON only.
    Include traffic_delta, keyword_wins_losses, feature_gains_losses, trending_score, explain.
```

---

### Full pipeline flow (step by step)

```
1. Load config for [COUNTRY] (geo, language, currency tokens)
2. Agent 1: Generate/refresh [KEYWORD_SET] via Keyword Miner
3. Agent 2: Pull SERP snapshots for prioritised keyword batches; store raw payloads
4. Extract domains, normalise by registrable domain + canonical host
5. Deduplicate: key = registrable_domain + country scope
6. Agent 3: Run Domain Classifier BEFORE expensive enrichment
7. Agent 5: Tech Stack Analyser on accepted domains
8. Agent 4: SEO Metrics Enrichment on accepted domains
9. Agent 6: Intent Scoring using evidence from Agents 1, 2, 4, 5
10. Agent 7: Change Detection monthly, write deltas and trend ranks
11. Generate AI summaries per domain
12. Publish materialised views for UX filters and exports
```

### Deduplication logic

- **Key:** registrable_domain (public suffix based) + country scope
- **Merge rules:** Keep earliest first_seen, retain all evidence arrays, reconcile conflicts by source priority
- **Conflict resolution:** Prefer direct crawl evidence over third party inference; store both with timestamps
- **Host variants:** Store separately (www.example.co.uk, shop.example.co.uk), map to canonical domain_id

### Error recovery system

- Every agent writes idempotent outputs keyed by job_id and entity_id
- Retry policy: exponential backoff with circuit breakers per external [DATA_SOURCE]
- Quarantine queue: domains with repeated failures held here, reprocessed weekly
- Dead letter queue: permanently failed jobs logged for manual review

### Logging and quality control

- Structured logs per agent run: counts in, counts out, error codes, latency, cost units consumed
- Sample audit set each run: compare computed scores to heuristic rules
- QA dashboard showing drift in model outputs and error rates
- Monthly cost audit: API spend by agent, cost per enriched domain

### Cron schedule and cost summary

| Agent | Schedule | Batch size | Monthly API cost (at 100K domains) |
|-------|----------|------------|-------------------------------------|
| 1: Keyword Miner | Weekly | Full keyword set | £0 (internal LLM) |
| 2: SERP Discovery | Daily (rotating) | 5,000 queries/day | £90 (DataForSEO queued) |
| 3: Domain Classifier | On discovery | All new domains | £0 (direct scrape + internal) |
| 4: SEO Metrics | Weekly/bi weekly | 5,000 domains/day | £450 (DataForSEO + Moz) |
| 5: Tech Stack | Bi weekly | 15,000 domains/day | £150 (infrastructure only, self hosted Wappalyzer) |
| 6: Intent Scoring | Weekly | All domains | £0 (internal calculation) |
| 7: Change Detection | Monthly + daily sampling | Full database | £0 (internal) |
| Contact/Social scraping | Monthly | 3,000 domains/day | £50 (infrastructure) |
| Ecommerce attributes | Monthly | 3,000 domains/day | £50 (infrastructure) |
| **Total** | | | **~£790/mo at 100K domains** |

---

## STACK 4: UX and Product Structure

### Prompt module

```text
ROLE
  You are a product designer for a database first SaaS.

INPUTS
  [SUBSCRIPTION_TIER], [USER_PERSONA]

TASK
  Design an Airtable style UX for search, filters, views, saved lists, exports.
  Define tier gating and upgrade prompts.
```

### UX model

One primary table (domains), multiple views, strict filters. Left navigation, main content area layout. Tier based feature gating via feature flags.

### Sidebar navigation

| Nav item | Description | Minimum tier |
|----------|-------------|-------------|
| Dashboard | Summary stats, top movers, pipeline health | Free |
| Domains (database) | Main table with all filter/view combinations | Free (25 lookups/mo) |
| > All domains | Full database view | Starter |
| > Verified ecommerce | Confidence score above threshold only | Starter |
| > High intent | Intent score 7+ | Professional |
| > Trending up | Biggest positive traffic delta MoM | Professional |
| > Trending down | Biggest negative traffic delta MoM | Professional |
| > New this week | Discovered in last 7 days | Free |
| > Merchant listing candidates | Strong structured data signals | Professional |
| > Platform slices | Pre filtered by Shopify, WooCommerce etc | Starter |
| Keywords | Keyword explorer showing which domains rank for what | Professional |
| SERP features | Aggregated SERP feature analysis | Professional |
| Saved lists | User created domain lists | Professional (25 lists) |
| Alerts | Technology changes, new domains, competitor monitoring | Professional |
| Exports and API | CSV export, API key management, usage monitoring | Professional |
| Billing and team | Account, subscription, team seats, integrations | All |

### Dashboard wireframe

```
+------------------------------------------------------------------+
| [PRODUCT_NAME]    Search domains...          [User] [Upgrade]     |
+------------------------------------------------------------------+
| SIDEBAR      |  MAIN CONTENT AREA                                |
|              |                                                    |
| Dashboard    |  +-------------------+  +---------------------+   |
| Domains      |  | Total UK Domains  |  | New This Week       |   |
|   All        |  | 847,293           |  | +2,847              |   |
|   Verified   |  +-------------------+  +---------------------+   |
|   High Intent|                                                    |
|   Trending   |  +-------------------+  +---------------------+   |
|   New        |  | Avg Domain Rating |  | Shopping Carousel % |   |
|   Platform   |  | 31.4              |  | 23.7% of tracked    |   |
| Keywords PRO |  +-------------------+  +---------------------+   |
| SERP Feat PRO|                                                    |
| Saved Lists  |  TOP GROWING DOMAINS THIS WEEK                     |
| Alerts   PRO |  +----------------------------------------------+ |
| Exports  PRO |  | Domain    | DR  | Traffic | Platform | Change | |
| Billing      |  | store.uk  | 67  | 145K    | Shopify  | +23%   | |
|              |  | shop.uk   | 54  | 89K     | Woo      | +18%   | |
|              |  | brand.uk  | 42  | 67K     | Magento  | +15%   | |
|              |  +----------------------------------------------+ |
|              |                                                    |
|              |  PLATFORM MARKET SHARE (UK)                        |
|              |  [Pie: Wix 23.3% | Shopify 23.1% |                |
|              |   WooCommerce 15.6% | Squarespace 15.1% | Other]  |
+------------------------------------------------------------------+
```

### Domain profile page wireframe

```
+------------------------------------------------------------------+
| example.co.uk                    [Add to List] [Export] [Alert]   |
+------------------------------------------------------------------+
| DR: 54 | DA: 48 | Traffic: 89K/mo | Platform: Shopify Plus       |
| Status: Active | Category: Sportswear | Last Updated: 2 days ago  |
| Intent Score: 8/10 | Confidence: 0.82                             |
+------------------------------------------------------------------+
| TAB: Overview | SEO | Technology | SERP | Contact | History       |
+------------------------------------------------------------------+
|                                                                    |
| AI SUMMARY                                                         |
| example.co.uk is an active UK ecommerce store on Shopify Plus     |
| in the sportswear category. DR 54 with ~89K monthly organic       |
| visitors. Appears in Shopping carousels. Traffic up 11% MoM.      |
|                                                                    |
| SERP FEATURES         | TECHNOLOGY STACK                          |
| Shopping Carousel: Y  | Ecommerce: Shopify Plus                   |
| PAA: Y                | Analytics: GA4, Hotjar                     |
| Featured Snippet: N   | Email: Klaviyo                             |
| Local Pack: N         | Chat: Zendesk                              |
| Sitelinks: Y          | CDN: Cloudflare                            |
| AI Overview: N        | Payments: Stripe, PayPal, Klarna           |
|                       | Shipping: DPD, Royal Mail                  |
|                                                                    |
| SCHEMA USAGE          | MARKETPLACE OVERLAP                        |
| Product: Y            | Amazon: 0.2                                |
| Review: Y             | eBay: 0.1                                  |
| Offer: Y              | Etsy: 0.0                                  |
| Merchant Eligible: Y  |                                            |
|                                                                    |
| TOP COMMERCIAL QUERIES                      [BUSINESS+ ONLY]      |
| +----------------------------------------------------------+     |
| | Query                    | Pos | Volume | Feature         |     |
| | buy running shoes uk     | 3   | 14,800 | Shopping        |     |
| | cheap running trainers   | 7   | 9,200  | Shopping, PAA   |     |
| | best running shoes 2026  | 12  | 5,400  | PAA             |     |
| +----------------------------------------------------------+     |
|                                                                    |
| TRAFFIC TREND [12 MONTH CHART]              [BUSINESS+ ONLY]      |
| [Line graph showing monthly organic traffic estimate]              |
|                                                                    |
| EVIDENCE TIMELINE                           [PROFESSIONAL+]       |
| [Chronological list of enrichment events with sources]             |
+------------------------------------------------------------------+
```

### Main database view: filter panel

```
FILTER BAR
+------------------------------------------------------------------+
| DR: [0] to [100]  | Traffic: [Any] v  | Intent: [1] to [10]      |
| Platform: [Any] v | Category: [Any] v  | Tech: [Any] v           |
| SERP Features: [Any] v | Status: [Active] v | Added: [Any] v     |
| Has affiliate: [Any] v | Paid ads: [Any] v                       |
+------------------------------------------------------------------+

TABLE COLUMNS (configurable):
Domain | Intent Score | Est Traffic | DR | Top Keyword | Top URL |
SERP Features | Platform | Category | Confidence | Last Updated

RIGHT PANEL (on row click):
  Summary | Evidence timeline | Keyword set | SERP feature history |
  Tech stack | Contact signals | Export row JSON
```

### Upgrade prompt logic (implement as modals/banners)

| Trigger | Tier gate | CTA copy |
|---------|-----------|----------|
| User hits 25 free lookups | Free to Starter | "You've used all free lookups this month. Starter gives you 500 lookups plus 12 more data fields." |
| User clicks blurred data rows | Free to Starter | "See the full picture. Starter starts at £39/mo." |
| User tries to export CSV | Starter to Professional | "Export and API access start at Professional." |
| User clicks greyed SERP intelligence | Starter to Professional | "SERP feature data available on Professional." |
| User exceeds 5 alerts | Professional to Business | "Need more alerts? Business gives you unlimited." |
| User requests white label export | Professional to Business | "White label reports available on Business." |
| User exceeds export credits | Professional to Business | "You exported 487 of 500 credits. Business gives you 2,000." |
| API usage approaches limit | Business to Enterprise | Account manager outreach (sales assisted) |

### Tier based feature access matrix

| Feature | Free | Starter £39/mo | Professional £119/mo | Business £279/mo | Enterprise £749+/mo |
|---------|------|-----------------|----------------------|-------------------|---------------------|
| Domain lookups/mo | 25 | 500 | Unlimited | Unlimited | Unlimited |
| Max rows per view | 100 | 5,000 | 50,000 | 250,000 | Unlimited |
| Search filters | 5 basic | 15 standard | 40+ advanced | 40+ advanced | 40+ advanced + custom |
| Domain profile fields | 8 basic | 20 standard | All fields | All fields | All fields |
| CSV export credits/mo | 0 | 50 | 500 | 2,000 | Unlimited |
| API calls/mo | 0 | 0 | 10,000 | 50,000 | Custom + SLA |
| Saved lists | 1 | 5 | 25 | Unlimited | Unlimited |
| Alerts | 0 | 5 | 50 | Unlimited | Unlimited |
| SERP feature data | None | Basic counts | Full detail | Full + history | Full + history |
| Intent score filter | None | View only | Filter + sort | Filter + sort + history | Full |
| Historical trends | None | None | 3 months | 12 months | Full archive |
| Top ranking queries | None | None | Top 3 per domain | Top 10 per domain | Full query data |
| Update cadence | Weekly | Weekly | Weekly + daily trending | Daily priority | Daily + custom runs |
| CRM integration | None | None | HubSpot, Salesforce | All CRMs + webhooks | Custom integrations |
| White label exports | None | None | None | Branded PDFs | Full white label API |
| Team seats | 1 | 1 | 3 (+£30/seat) | 5 to 10 (+£30/seat) | Unlimited |
| Workspace sharing | None | None | None | Enabled | Enabled + SSO |
| Support | Community | Email (48h) | Priority email (24h) | Dedicated CSM | Dedicated CSM + SLA |

### API access specification

- Token based auth per workspace
- Per tier quotas enforced at API gateway level
- Cursor pagination with stable sorting by domain_id
- Rate limiting: Professional 100 req/min, Business 500 req/min, Enterprise custom
- Endpoints: /domains, /domains/{id}, /search, /exports, /alerts, /webhooks

---

## STACK 5: Monetisation Engine

### Prompt module

```text
ROLE
  You design pricing, packaging, and upsells for a data SaaS.

INPUTS
  [SUBSCRIPTION_TIER], [USER_PERSONA]

TASK
  Define tiers, limits, and conversion angles by persona.
  Output a tier comparison and upsell pathways.
```

### Pricing anchor logic

Users pay for three things: **coverage** (how many domains they can see), **freshness** (how recent the data is), and **exportability** (how they can get data out). Gate the "compounding" value behind daily deltas, API, and advanced filters. Keep Starter cheap enough for solo SEOs, then upsell on workflow limits.

### Tier comparison table

| | Free | Starter | Professional | Business | Enterprise |
|---|------|---------|-------------|----------|------------|
| Monthly price | £0 | £39 | £119 | £279 | £749+ (custom) |
| Annual price | £0 | £33/mo (£396/yr) | £99/mo (£1,188/yr) | £229/mo (£2,748/yr) | Custom (annual required) |
| Annual saving | N/A | 15% | 17% | 18% | Negotiated |
| Target persona | Analysts, journalists | Affiliate SEOs, freelancers | Agencies, SaaS vendors, link builders | Larger agencies, DTC brands | PE/M&A, aggregators, enterprise SaaS |
| Domain lookups | 25/mo | 500/mo | Unlimited | Unlimited | Unlimited |
| Record access | 100 per view | 5,000 per view | 50,000 per view | 250,000 per view | Unlimited |
| CSV exports | 0 | 50 credits/mo | 500 credits/mo | 2,000 credits/mo | Unlimited |
| API calls | 0 | 0 | 10,000/mo | 50,000/mo | Custom + SLA |
| Alerts | 0 | 5 | 50 | Unlimited | Unlimited |
| Saved lists | 1 | 5 | 25 | Unlimited | Unlimited |
| Seats | 1 | 1 | 3 | 5 to 10 | Unlimited |
| Data freshness | Weekly | Weekly | Weekly + daily trending | Daily priority | Daily + custom |
| Historical data | None | None | 3 months | 12 months | Full archive |
| White label | None | None | None | Branded PDFs | Full white label API |
| Data delivery | Dashboard only | Dashboard only | Dashboard + CSV | Dashboard + CSV + API | S3/GCS + API |

### Competitive pricing benchmark

| Competitor | Comparable tier | Their price | Our price | Our advantage |
|------------|----------------|-------------|-----------|---------------|
| Store Leads Premium | Starter | $75/mo (~£60) | £39 | Intent validation + SERP intelligence included |
| Store Leads Pro | Professional | $250/mo (~£200) | £119 | API access + SERP feature data + intent scoring |
| BuiltWith Basic | Professional | $295/mo (~£235) | £119 | Ecommerce specific data BuiltWith lacks entirely |
| BuiltWith Pro | Business | $495/mo (~£395) | £279 | SERP intelligence + historical trends + white label |
| SimilarWeb Starter | Professional | $199/mo (~£159) | £119 | UK ecommerce depth SimilarWeb cannot match |

### Launch pricing strategy

**Months 1 to 3: Founding Member Programme**
- 50% off annual Professional: £594/yr (£49.50/mo) locked for life
- Limited to first 200 members
- Requires annual commitment
- "Founding Member" badge + priority feature request voting

**Months 3 to 4: AppSumo Lifetime Deal**
- £59 one time for Starter equivalent (lifetime)
- Target: 500 to 1,000 users
- Primary value: user acquisition, product validation, G2/Capterra reviews

**Months 4 to 5: ProductHunt Launch**
- 40% off first year on any tier
- Exclusive 7 day coupon

**Month 6+: Standard pricing with annual discounts**

### Conversion angles by persona

| [USER_PERSONA] | Primary hook | Retention mechanism | Upgrade trigger |
|----------------|-------------|---------------------|----------------|
| Affiliate SEOs | "Find money SERPs and winners early" | Trending deltas, new domain alerts | Hits export limit, wants affiliate detection |
| Link builders | "Outreach ready ecommerce targets" | Fresh prospect lists, DR filtering | Needs CSV exports, contact data |
| DTC brands | "See who outranks you on buying terms" | Competitor monitoring alerts | Wants SERP feature history, category analysis |
| Agencies | "Repeatable market maps for clients" | White label reports, team seats | Needs API, white label, more seats |
| SaaS vendors | "Find stores missing your tool" | Tech stack filtering, CRM integration | Needs API for pipeline integration |
| PE/M&A | "Source acquisition targets with data" | Revenue estimates, historical trends | Needs full archive, custom data pulls |

### Add on modules (Professional+ only)

| Add on | Price | Description |
|--------|-------|-------------|
| UK Deep Data Pack | £39/mo | Companies House data, VAT registration, UK postcode analysis |
| Affiliate Programme Detection | £29/mo | Weekly scan for affiliate indicators across all tracked domains |
| Personal Contact Enrichment | £49/mo | Decision maker names and direct emails via consented third party (GDPR compliant) |
| Custom Keyword Tracking | £59/mo | Add your own [KEYWORD_SET] for SERP monitoring |
| Slack/Teams Notifications | £19/mo | Real time alert delivery to messaging platforms |
| Niche Packs | £29/mo each | Pre built vertical databases (fashion, electronics, health, home) refreshed monthly |

### Revenue projections (conservative)

| Month | Free users | Paid users | MRR | Key milestone |
|-------|-----------|------------|-----|---------------|
| 3 | 500 | 50 | £2,475 | Founding members |
| 6 | 2,000 | 150 | £7,500 | Post AppSumo/PH launch |
| 9 | 4,000 | 300 | £18,000 | Organic growth + content marketing |
| 12 | 7,000 | 500 | £32,000 | Full tier mix + first enterprise deals |

---

## STACK 6: Automation and Scale

### Prompt module

```text
ROLE
  You are a pipeline engineer designing integrations and automated reporting.

INPUTS
  [UPDATE_FREQUENCY], [SUBSCRIPTION_TIER]

TASK
  Define Sheets/API bulk expansion, AI summaries, reports, changelog, alerts, webhooks.
  Provide a text architecture diagram plus JSON integration examples.
```

### Keyword expansion engine

```json
{
  "expansion_engine": {
    "intent_modifiers": {
      "transactional": ["buy", "order", "shop", "purchase"],
      "commercial_investigation": ["best", "top", "review", "compare", "vs"],
      "price_sensitive": ["cheap", "affordable", "discount", "sale", "voucher", "under £[PRICE]"],
      "delivery_focused": ["free delivery", "next day delivery", "click and collect"],
      "geo_qualified": ["[PRODUCT] UK", "[PRODUCT] online UK", "[PRODUCT] near me"]
    },
    "product_categories": {
      "source": "Google Product Taxonomy UK",
      "levels": 3,
      "total_categories": 5427,
      "priority_categories": 200
    },
    "output_formula": "[INTENT_MODIFIER] + [PRODUCT_CATEGORY_L2] + [GEO_MODIFIER]",
    "estimated_queries": {
      "UK_initial": 50000,
      "UK_full_coverage": 250000,
      "US_initial": 75000
    }
  }
}
```

### Bulk domain import via API

```json
{
  "endpoint": "POST /api/v1/domains/import",
  "payload": {
    "workspace_id": "uuid",
    "source": "sheets_upload",
    "domains": [
      { "domain": "example.co.uk", "tags": ["prospecting", "footwear"] },
      { "domain": "shop.co.uk", "tags": ["competitor_set"] }
    ],
    "run_enrichment": true
  }
}
```

### AI summary generation

Run as post enrichment process using local LLM (Llama 3 8B) or OpenAI API for cost efficiency.

**Template:**
```
[domain] is a [status] [COUNTRY] ecommerce store on [platform] ([platform_plan])
in the [category_primary] category. DR [DR] with approximately [organic_traffic_estimate]
monthly organic visitors and [referring_domains_count] referring domains. Stack includes
[top_5_technologies]. [Active SERP features listed]. [Traffic trend statement].
```

**Cost:** ~£0.002/summary (GPT 4o mini) or £0.00 (self hosted Llama 3 8B)

### Alert system

| Alert type | Trigger | Delivery | Minimum tier |
|------------|---------|----------|-------------|
| New domain in category | Agent 2 discovers domain matching saved filter | Email, webhook | Professional |
| Technology change | Agent 5 detects platform migration or new tool install | Email, webhook, Slack | Professional |
| DR/DA change | Agent 4 detects authority shift exceeding threshold | Email, webhook | Professional |
| SERP feature gain/loss | Agent 6 detects Shopping carousel entry/exit | Email, webhook | Business |
| Competitor monitoring | Tracked competitor shows significant metric change | Email, webhook, Slack | Professional |
| Database milestone | Total tracked domains crosses threshold | Email | Free |

**Alert rules:** All alerts must be opt in. Rate limited to prevent spam (max 10 alerts per day per user for email, no limit for webhooks).

### Webhook specification

```json
{
  "endpoint": "POST {user_configured_url}",
  "headers": {
    "Content-Type": "application/json",
    "X-Webhook-Secret": "{workspace_secret}"
  },
  "payload": {
    "event_type": "technology_change",
    "workspace_id": "uuid",
    "tier": "[SUBSCRIPTION_TIER]",
    "occurred_at": "2026-02-18T09:30:00Z",
    "domain": "example.co.uk",
    "change": {
      "field": "ecommerce_platform",
      "old_value": "WooCommerce",
      "new_value": "Shopify",
      "detected_at": "2026-02-18T09:25:00Z"
    },
    "domain_snapshot": {
      "domain_rating": 54,
      "organic_traffic_estimate": 89000,
      "category_primary": "Fashion",
      "intent_score": 8
    },
    "links": {
      "app_domain_url": "/domains/example.co.uk"
    }
  }
}
```

### Webhook delivery by tier

| Tier | Email | Slack | Webhooks | Scheduled exports |
|------|-------|-------|----------|-------------------|
| Free | Database milestones only | No | No | No |
| Starter | Weekly digest | No | No | No |
| Professional | Per event | Basic webhook | Standard | Monthly PDF |
| Business | Per event | Full integration | Per event | Weekly + monthly |
| Enterprise | Per event | Full + custom | Per event + batch | Daily + custom |

### Monthly report automation

Auto generate PDF report per saved list:
- Top movers (biggest traffic delta)
- New entrants (domains discovered this month)
- SERP feature changes
- Technology migration summary
- Category level trends

Delivery: email for Professional+, webhook for Business+.

### Changelog generation

- Persist per domain diffs (Agent 7 output)
- Aggregate changes by category and feature
- Expose public changelog view in UI for trust and retention
- Versioned: each changelog entry references schema_version and pipeline run_id

### Infrastructure architecture

```
                    [CloudFlare CDN + WAF + Rate Limiting]
                                    |
                    [Application Load Balancer]
                                    |
                +-------------------+-------------------+
                |                                       |
        [API Cluster]                          [Frontend]
        FastAPI on ECS Fargate                 Next.js on Vercel
        3 to 8 containers                     Edge cached
        Auto scaling on CPU                    
                |
        [Redis Cluster]
        Cache + Rate Limiting
        + Celery Broker
                |
    +-----------+-----------+
    |                       |
[PostgreSQL RDS]      [ClickHouse Cloud]
Multi AZ, r6g.xlarge  Analytics DB
Primary + Read Replica Time series queries
JSONB + GIN indexes    Materialised views
    |
[PeerDB CDC Pipeline]
    |
    v
[ClickHouse Cloud]

    [Celery Worker Fleet]
    7 agent types
    4 to 20 workers per agent
    Priority queues per agent type
    Auto scaling on queue depth

    [Object Storage (S3)]
    Raw SERP payloads
    HTML snapshots
    Provider response hashes
    CSV export staging

    [Monitoring Stack]
    Prometheus + Grafana (infra)
    Sentry (errors)
    Custom pipeline dashboards (agent health, queue depth, cost burn)
```

### Cost scaling model

| Scale | Domains tracked | Monthly infra | Monthly data APIs | Total monthly | Break even MRR |
|-------|----------------|---------------|-------------------|---------------|----------------|
| MVP | 10,000 | £400 | £200 | £600 | £600 (16 Starters) |
| Growth | 100,000 | £2,500 | £800 | £3,300 | £3,300 (28 Professionals) |
| Scale | 500,000 | £8,000 | £3,000 | £11,000 | £11,000 (40 Business) |
| Full UK | 1,000,000 | £14,000 | £5,500 | £19,500 | £19,500 (26 Enterprise) |

### Zero touch operations runbook

| Process | Trigger | Action | Fallback |
|---------|---------|--------|----------|
| New domain discovered | Agent 2 SERP result | Auto queue through Agents 3 to 7 | Manual review queue if validation fails |
| Domain goes inactive | 3 consecutive HTTP failures | Move to "inactive" status; pause enrichment | Auto reactivate if domain resolves within 30 days |
| API budget exceeded | Monthly spend exceeds 120% budget | Pause lowest priority enrichment queues | Alert ops; resume on budget reset |
| Worker failure | Worker process crashes | Celery auto restarts; task re queued | Page on call if 3+ workers fail simultaneously |
| Database growth | PostgreSQL storage exceeds 80% | Auto scale RDS storage | Archive domains inactive 6+ months to cold storage |
| Traffic spike | API requests exceed 200% normal | CloudFlare rate limiting; Redis cache absorbs repeats | Scale ECS tasks; queue overflow |
| Data source outage | [DATA_SOURCE] returns errors for 30+ minutes | Circuit breaker trips; switch to backup provider if available | Alert ops; queue affected tasks for retry |

---

## STACK 7: Expansion Layer (Future USA)

### Prompt module

```text
ROLE
  You are planning a second country launch.

INPUTS
  [COUNTRY], [EXPANSION_COUNTRY], [KEYWORD_SET], [SERP_FEATURE], [DATA_SOURCE]

TASK
  Identify what changes when expanding to [EXPANSION_COUNTRY].
  Provide risks and a phased scaling roadmap.
```

### UK vs US differences

| Dimension | UK ([COUNTRY]) | USA ([EXPANSION_COUNTRY]) | Platform implication |
|-----------|----------------|---------------------------|---------------------|
| Market size | ~1.07M ecommerce domains | ~4.5M+ ecommerce domains | 4x infrastructure and API costs |
| Market value | £127.4B annual ecommerce | $1.1T+ annual ecommerce | Higher willingness to pay |
| Dominant platforms | Wix 23.3%, Shopify 23.1%, WooCommerce 15.6% | Shopify ~29%, WooCommerce ~23%, Wix ~13% | Adjust keyword weighting by platform |
| Intent modifiers | "free delivery", "voucher", "click and collect" | "free shipping", "coupon", "BOPIS" | Separate [KEYWORD_SET] per country |
| Currency | GBP (£) | USD ($) | Multi currency in data model + UI |
| Trust signals | Trustpilot dominant | BBB, Consumer Reports, Wirecutter | Different review platform detection |
| Seasonal events | Boxing Day, January Sales, Bank Holidays | Black Friday, Memorial Day, Prime Day | Vary SERP crawl intensity by country calendar |
| SERP features | AI Overviews ~19%, Shopping carousel ~81% retail | AI Overviews ~15 to 16%, Shopping carousel similar | AI Overview detection more critical for UK |
| Local search | "near me" less common; postcode based | "near me" dominant; ZIP code based | Different geo modifier patterns |
| Spelling | British English (colour, favourite) | American English (color, favorite) | Country appropriate keyword sets |
| Data regulation | UK GDPR (Data Protection Act 2018) | CAN SPAM, CCPA/CPRA, varies by state | Different compliance per country |
| Delivery language | "delivery", Royal Mail, DPD, Evri | "shipping", USPS, FedEx, UPS | Country specific provider detection |
| Google domain | google.co.uk | google.com | Separate SERP API parameters |
| Company registry | Companies House API | SEC EDGAR, state registries | Different enrichment sources |

### US keyword set differences

```json
{
  "US_intent_modifiers": {
    "transactional": ["buy", "order", "shop", "purchase", "get"],
    "commercial_investigation": ["best", "top rated", "review", "compare", "vs", "worth it"],
    "price_sensitive": ["cheap", "affordable", "deal", "coupon", "promo code", "clearance", "under $[PRICE]"],
    "delivery_focused": ["free shipping", "2 day shipping", "same day delivery", "buy online pick up in store"],
    "geo_qualified": ["[PRODUCT] near me", "[PRODUCT] USA", "[PRODUCT] online"]
  }
}
```

### Technical requirements for multi country

**Database changes:**
- All domain records already tagged with `country` field (in schema)
- Partition ClickHouse tables by country for query performance
- Separate keyword queues per [COUNTRY]
- Country specific freshness scoring weights

**Agent adaptations:**
- Agent 1: Parameterised by [COUNTRY], [KEYWORD_SET], search engine domain
- Agent 2: Country parameter in DataForSEO API calls
- Agent 3: No changes (classification is country agnostic)
- Agent 4: No changes (SEO metrics are global)
- Agent 5: No changes (technology detection is country agnostic)
- Agent 6: Country specific SERP feature baselines and scoring weights
- Agent 7: Country specific freshness thresholds
- Contact agent: Country specific phone/address format validation
- Ecommerce agent: Country specific shipping/payment/affiliate network lists

**Infrastructure:**
- US region PostgreSQL read replica for latency
- CloudFlare edge caching from US PoPs
- Additional monthly cost for US at 500K domains: £6,000 to £8,000

### Scaling roadmap

| Phase | Timeline | Scope | Key activities |
|-------|----------|-------|----------------|
| 0: UK Foundation | Months 1 to 6 | 100K UK domains | Build all 7 agents, launch MVP, founding members, validate data quality |
| 1: UK Full Coverage | Months 6 to 9 | 500K UK domains | Scale agents, full pricing tiers, content marketing, first enterprise deals |
| 2: Dual Country Prep | Months 9 to 12 | UK mature + US prep | Achieve £30K+ MRR, build US keyword set, refactor for multi country, recruit US beta testers |
| 3: US Beta | Months 12 to 15 | 100K US domains | Duplicate SERP discovery for US, adapt detection, US pricing page |
| 4: US Full Launch | Months 15 to 18 | 500K US domains | Full US marketing, US specific add ons, combined UK+US enterprise tier |
| 5: Multi Country | Months 18 to 24 | Framework abstracted | Evaluate DE, FR, AU based on demand signals |

### Risk analysis

| Risk | Probability | Impact | Mitigation |
|------|------------|--------|------------|
| US market saturated by Store Leads, BuiltWith, SimilarWeb | High | High | Differentiate on intent validation and SERP intelligence; price below incumbents |
| US data collection costs 4x UK | High | Medium | Priority scoring to crawl high value first; volume discounts with DataForSEO |
| US customers expect real time data | Medium | High | Priority re crawl for API queried domains; "on demand refresh" premium feature |
| GDPR/CCPA compliance complexity | Medium | Medium | Data privacy counsel before US launch; granular consent and deletion workflows |
| Ahrefs/SEMrush launches competing UK product | Low | Very High | Move fast; build brand loyalty; lock annual enterprise contracts |
| DataForSEO pricing changes | Medium | High | Secondary SERP API (Bright Data backup); keep SERP spend below 30% of revenue |
| Google changes SERP structure | Medium | Medium | Flexible feature parsing in Agent 6; monitor Google Search Central |
| SERP scraping legal exposure | Medium | High | Use licensed providers only; store payload hashes; abstract [DATA_SOURCE] behind provider interface |

### Expansion decision criteria

Only expand to [EXPANSION_COUNTRY] after:
1. UK workflows prove retention (month 6+ cohort retention above 70%)
2. UK MRR exceeds £25K (covers infrastructure headroom)
3. Provider interface abstraction is complete (no hard coded UK assumptions)
4. At least 3 Enterprise customers validate cross country demand

---

## Appendix: Tech stack summary

| Component | Technology | Purpose |
|-----------|-----------|---------|
| Primary database | PostgreSQL (RDS, r6g.xlarge, Multi AZ) | Domain records, JSONB enrichment |
| Analytics database | ClickHouse Cloud | Time series, trending, historical queries |
| CDC pipeline | PeerDB | PostgreSQL to ClickHouse sync |
| API framework | FastAPI (Python) | REST API |
| Task queue | Celery + Redis | Agent orchestration, async processing |
| Headless browser | Playwright (Chromium) | Tech detection, page rendering |
| Tech detection | Wappalyzer (self hosted, MIT) | Technology fingerprinting |
| Frontend | Next.js on Vercel | Dashboard, SSR |
| CDN/WAF | CloudFlare | Caching, rate limiting, DDoS protection |
| Object storage | S3 | Raw payloads, HTML snapshots, export staging |
| Monitoring | Prometheus + Grafana + Sentry | Infrastructure, errors, pipeline health |
| SERP data | DataForSEO (queued mode) | SERP snapshots, keyword data |
| Backlink data | DataForSEO Backlinks API | DR, referring domains, backlinks |
| Authority data | Moz Links API | DA, PA, Spam Score |
| Company data | Companies House API | UK company verification |
| Container orchestration | ECS Fargate | API and worker containers |
| Auth | Token based (workspace scoped) | API authentication |
| Payments | Stripe | Subscription billing |

---

## Appendix: Implementation order for Claude Code

```
Phase 1: Foundation (Weeks 1 to 3)
  1. Set up PostgreSQL schema (Stack 2 migration SQL)
  2. Build config/variables system with all [VARIABLE] placeholders
  3. Implement provider interface for [DATA_SOURCE] abstraction
  4. Build Agent 1 (Keyword Miner) and Agent 2 (SERP Discovery)
  5. Build Agent 3 (Domain Classifier)
  6. Set up Celery + Redis task queue

Phase 2: Enrichment (Weeks 3 to 5)
  7. Build Agent 5 (Tech Stack Analyser) with self hosted Wappalyzer
  8. Build Agent 4 (SEO Metrics Enrichment)
  9. Build Agent 6 (Intent Scoring)
  10. Build Agent 7 (Change Detection)
  11. Set up ClickHouse + PeerDB CDC pipeline

Phase 3: API and Auth (Weeks 5 to 7)
  12. Build FastAPI endpoints (/domains, /search, /exports)
  13. Implement token auth and tier based rate limiting
  14. Implement feature flags for tier gating
  15. Build webhook delivery system

Phase 4: Frontend (Weeks 7 to 10)
  16. Build Next.js dashboard (Stack 4 wireframes)
  17. Implement filter panel and database views
  18. Build domain profile page
  19. Implement upgrade prompt modals
  20. Build saved lists and alerts UI

Phase 5: Monetisation (Weeks 10 to 12)
  21. Integrate Stripe billing (Stack 5 tier table)
  22. Implement export credit system
  23. Build API usage monitoring
  24. Launch Founding Member programme

Phase 6: Scale (Ongoing)
  25. Set up monitoring stack (Prometheus + Grafana + Sentry)
  26. Implement zero touch operations runbook
  27. Build AI summary generation pipeline
  28. Build monthly report automation
```
